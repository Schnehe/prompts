<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Prompt-Sammlung — Kategorisiert</title>
<style>
  :root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --accent:#2b6ef6;
    --muted:#6b7280;
    --success:#059669;
    --radius:12px;
    --gap:12px;
    font-family: Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  body{
    margin:0;
    background:linear-gradient(180deg, var(--bg), #eef2ff);
    padding:18px;
    -webkit-font-smoothing:antialiased;
  }
  .container{
    max-width:1000px;
    margin:0 auto;
  }
  header{ display:flex; gap:12px; align-items:center; margin-bottom:14px; }
  h1{ margin:0; font-size:1.2rem; }
  p.lead{ margin:0; color:var(--muted); font-size:0.95rem; }

  .controls{ display:flex; gap:8px; margin:12px 0 18px 0; flex-wrap:wrap; }
  .btn{ background:var(--accent); color:white; border:0; padding:9px 12px; border-radius:10px; font-weight:600; cursor:pointer; }
  .btn.ghost{ background:transparent; color:var(--accent); border:1px solid rgba(43,110,246,0.12); box-shadow:none; }

  input.search{ padding:10px 12px; border-radius:10px; border:1px solid #e6e9ef; min-width:160px; }
  select.filter{ padding:10px 12px; border-radius:10px; border:1px solid #e6e9ef; }

  .category{ margin-bottom:16px; }
  .cat-header{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
  .cat-title{ font-weight:800; font-size:1rem; }
  .cat-controls{ display:flex; gap:8px; }

  .list{ margin-top:10px; display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:12px; }
  .card{ background:var(--card); border-radius:12px; padding:12px; box-shadow:0 6px 18px rgba(15,23,42,0.04); display:flex; flex-direction:column; gap:8px; }
  .prompt-text{ white-space:pre-wrap; background:#f3f4f6; padding:10px; border-radius:8px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace; font-size:0.9rem; color:#111827; }
  .card-footer{ display:flex; gap:8px; justify-content:space-between; align-items:center; }
  .small{ font-size:0.82rem; color:var(--muted); }

  #toast{ position:fixed; left:50%; transform:translateX(-50%) translateY(20px); bottom:16px; background:#111827; color:white; padding:10px 16px; border-radius:10px; opacity:0; pointer-events:none; transition:all .25s ease; z-index:999; }
  #toast.show{ transform:translateX(-50%) translateY(0); opacity:1; pointer-events:auto; }

  .empty{ color:var(--muted); font-style:italic; }

  @media (max-width:420px){ .controls{ flex-direction:column; align-items:stretch; } header{ flex-direction:column; align-items:flex-start; gap:6px; } .list{ grid-template-columns:1fr; } }
</style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <div>
        <h1>Prompt-Sammlung — Kategorisiert</h1>
        <p class="lead">Tippe auf „Kopieren“, um den Prompt in die Zwischenablage zu kopieren. Hoste die Datei per HTTPS (SharePoint/OneDrive), damit Kopieren zuverlässig funktioniert.</p>
      </div>
    </header>

    <div class="controls">
      <input class="search" id="search" placeholder="Suche (z. B. 'thickness' oder 'outliners')" aria-label="Suche Prompts" />
      <select class="filter" id="filter">
        <option value="">Alle Kategorien</option>
      </select>
      <button class="btn" id="copyAll">Alle kopieren</button>
      <button class="btn ghost" id="downloadTxt">Als TXT herunterladen</button>
    </div>

    <main id="main">
      <!-- Kategorien werden hier gerendert -->
    </main>

    <div id="toast" role="status" aria-live="polite">Kopiert ✓</div>
  </div>

<script>
// PROMPTS: hier die Prompts mit Kategorie
const PROMPTS = [
  { id:1, category: "Analysis of production", prompt: "Create a list of the top 10 setup scrap of all data." },
  { id:2, category: "Analysis of production", prompt: "Which product reached the highest throughput?" },
  { id:3, category: "Analysis of production", prompt: "Create a list of top 10 customer in term of good production." },
  { id:4, category: "Analysis of production", prompt: "Sort all product on this machine categories of their thickness for 0-40, 40-100 and >100µm." },
  { id:5, category: "Analysis of production", prompt: "Whats the average throughput for this machine? Look at all data" },
  { id:6, category: "Analysis of production", prompt: "Have there been jobs where the actual job length was more than 10% longer than the set job length?" },
  { id:7, category: "Analysis of production", prompt: "Create a list of all downtimes this week." },
  { id:8, category: "Analysis of production", prompt: "Compare the current production with all previous production of the same product. Create a table of all setup times." },

  { id:9, category: "Analysis of production – More complex", prompt: "Create a comparison table comparing days of last week with each other in terms of total good production, total scrap during production, total scrap during setup, total production time and total setup time and amount of jobs produced." },
  { id:10, category: "Analysis of production – More complex", prompt: "Create a list of the top ten products produced of all data available, based on the sum of good production. List them in a table. Add columns for the sum of good production kg, film thickness and film width of the product." },
  { id:11, category: "Analysis of production – More complex", prompt: "Compare all jobs of last week in a table. Columns shall be setup waste divided by good production amount in percent, total good production amount, 2-sigma thickness tolerance average and average output. Sort them by setup waste." },

  { id:12, category: "Working outlook in the future of process analysis", prompt: "Search yesterdays data for statistical 3-sigma outliners in the actual thickness, actual width and thickness deviation inside." },
  { id:13, category: "Working outlook in the future of process analysis", prompt: "Have there been times where the machine was in production status, but the width controller was off?" },
  { id:14, category: "Working outlook in the future of process analysis", prompt: "Have there been times last week when the machine was in production, but the thickness control was off?" },

  { id:15, category: "For the brave – Special prompt for outliners. Sometimes only works on the second or third try.", prompt: "Search yesterdays data for z-score outliners in the actual thickness, actual width and thickness deviation." },
  { id:16, category: "For the brave – Special prompt for outliners. Sometimes only works on the second or third try.", prompt: "Search last weeks data for z-score outliners in the actual thickness, actual width and thickness deviation inside. Combine related time periods. Create a table." }
];

/* Utilities */
function el(tag, props={}, children=[]){
  const e = document.createElement(tag);
  Object.entries(props).forEach(([k,v])=>{
    if(k === "class") e.className = v;
    else if(k === "text") e.textContent = v;
    else if(k.startsWith("data-")) e.setAttribute(k, v);
    else e[k] = v;
  });
  (Array.isArray(children)?children:[children]).forEach(c=>{
    if(!c) return;
    if(typeof c === "string") e.appendChild(document.createTextNode(c));
    else e.appendChild(c);
  });
  return e;
}

// Group by category
function groupByCategory(prompts){
  const map = new Map();
  prompts.forEach(p=>{
    if(!map.has(p.category)) map.set(p.category, []);
    map.get(p.category).push(p);
  });
  return map;
}

const toast = document.getElementById('toast');
let toastTimer = null;
function showToast(msg="Kopiert ✓"){
  toast.textContent = msg;
  toast.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> toast.classList.remove('show'), 1600);
}

async function copyText(text){
  try{
    if(navigator.clipboard && navigator.clipboard.writeText){
      await navigator.clipboard.writeText(text);
      showToast('Kopiert ✓');
      return true;
    }
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed'; ta.style.left = '-9999px';
    document.body.appendChild(ta);
    ta.select(); ta.setSelectionRange(0, ta.value.length);
    const ok = document.execCommand('copy');
    document.body.removeChild(ta);
    if(ok){ showToast('Kopiert ✓'); return true; }
    throw new Error('Copy not supported');
  }catch(e){ showToast('Kopieren fehlgeschlagen — manuell markieren.'); console.warn(e); return false; }
}

function render(prompts){
  const main = document.getElementById('main');
  main.innerHTML = '';
  const grouped = groupByCategory(prompts);
  const categories = Array.from(grouped.keys());

  // populate filter
  const filter = document.getElementById('filter');
  filter.innerHTML = '<option value="">Alle Kategorien</option>' + categories.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join('');

  categories.forEach(cat => {
    const items = grouped.get(cat);
    const categoryEl = el('section',{ class:'category', 'data-cat':cat });
    const header = el('div',{ class:'cat-header' }, [ el('div',{ class:'cat-title', text:cat }), el('div',{ class:'cat-controls' }) ]);

    // buttons: expand/collapse, copy category, download category
    const controls = header.querySelector('.cat-controls');
    const toggle = el('button',{ class:'btn ghost', text:'Ein-/Ausklappen', onclick: (e)=>{ const list = categoryEl.querySelector('.list'); list.style.display = list.style.display === 'none' ? 'grid' : 'none'; } });
    const copyCat = el('button',{ class:'btn', text:'Kategorie kopieren', onclick: ()=> copyCategory(cat) });
    const dlCat = el('button',{ class:'btn ghost', text:'Kategorie als TXT', onclick: ()=> downloadCategory(cat) });
    controls.appendChild(toggle); controls.appendChild(copyCat); controls.appendChild(dlCat);

    const list = el('div',{ class:'list' });
    items.forEach(p=>{
      const card = el('article',{ class:'card', role:'article' });
      const text = el('pre',{ class:'prompt-text', text:p.prompt, tabindex:0, 'aria-label':`Prompt: ${p.prompt}` });
      const footer = el('div',{ class:'card-footer' });
      const small = el('div',{ class:'small', text:`ID: ${p.id}` });
      const btns = el('div');
      const copyBtn = el('button',{ class:'btn', text:'Kopieren', onclick: ()=> copyText(p.prompt) });
      const shareBtn = el('button',{ class:'btn ghost', text:'Teilen', onclick: ()=> sharePrompt(p) });
      btns.appendChild(copyBtn); btns.appendChild(shareBtn);
      footer.appendChild(small); footer.appendChild(btns);
      card.appendChild(text); card.appendChild(footer);
      list.appendChild(card);
    });

    categoryEl.appendChild(header);
    categoryEl.appendChild(list);
    main.appendChild(categoryEl);
  });
}

function escapeHtml(s){ return String(s).replace(/[&<>\"']/g, function(c){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]; }); }

async function copyCategory(category){
  const items = PROMPTS.filter(p => p.category === category);
  if(items.length === 0){ showToast('Keine Prompts in dieser Kategorie'); return; }
  const text = items.map(i => i.prompt).join('\n\n');
  await copyText(text);
}

function downloadCategory(category){
  const items = PROMPTS.filter(p => p.category === category);
  if(items.length === 0){ alert('Keine Prompts zum Herunterladen in dieser Kategorie.'); return; }
  const content = items.map(i => `${i.category} - ${i.prompt}\n\n`).join('');
  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `${sanitizeFilename(category)}.txt`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

function sanitizeFilename(s){ return s.replace(/[^a-z0-9_\-\. ]/gi,'_').slice(0,120); }

// copy all
document.getElementById('copyAll').addEventListener('click', async ()=>{
  const text = PROMPTS.map(p=>`${p.category} - ${p.prompt}`).join('\n\n');
  await copyText(text);
});

// download all
document.getElementById('downloadTxt').addEventListener('click', ()=>{
  const content = PROMPTS.map(p=>`${p.category} - ${p.prompt}\n\n`).join('');
  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `prompts_all.txt`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

// search
const search = document.getElementById('search');
search.addEventListener('input', (e)=>{
  const q = String(e.target.value || '').toLowerCase().trim();
  if(!q){ render(PROMPTS); return; }
  const filtered = PROMPTS.filter(p => (p.prompt + ' ' + p.category).toLowerCase().includes(q));
  render(filtered);
});

// filter by category select
const filterSelect = document.getElementById('filter');
filterSelect.addEventListener('change', (e)=>{
  const val = e.target.value;
  if(!val){ render(PROMPTS); return; }
  const filtered = PROMPTS.filter(p => p.category === val);
  render(filtered);
});

// Web Share API fallback for sharing
async function sharePrompt(p){
  const text = `${p.category} - ${p.prompt}`;
  if(navigator.share){
    try{ await navigator.share({ title: 'Prompt: ' + (p.prompt.slice(0,30) + '...'), text }); showToast('Geteilt ✓'); }
    catch(e){}
  } else {
    const ok = await copyText(text);
    if(!ok) alert('Teilen nicht möglich — markiere den Prompt manuell.');
  }
}

// initial render
render(PROMPTS);

// allow Enter to copy when focus on pre
document.body.addEventListener('keydown', (ev)=>{
  if(ev.key === 'Enter' && document.activeElement && document.activeElement.classList && document.activeElement.classList.contains('prompt-text')){
    copyText(document.activeElement.textContent);
  }
});

</script>
</body>
</html>
